<pre class="code">
<span class="srcline"><span class="lineno"><a href="196,17" id="srcline17"> 17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="196,18" id="srcline18"> 18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="196,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">% -------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%http://www.mathworks.com/matlabcentral/fileexchange/26946-label-connected-components-in-2-d-array</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">% -------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,22" id="srcline22"> 22</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S15T371U90">L</span>,<span class="var type1" id="S16T4U91">num</span>,<span class="var type0" id="S17T0U92">sz</span>] = label (<span class="var type1" id="S18T354U95">I</span>,<span class="mxinfo " id="T4:U4"><span class="var type2" id="S19T4V4U96">n</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="196,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%LABEL Label connected components in 2-D arrays.</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%   LABEL is a generalization of BWLABEL: BWLABEL works with 2-D binary</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%   images only, whereas LABEL works with 2-D arrays of any class. Use</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%   BWLABEL if the input is binary since BWLABEL will be much faster.</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%   L = LABEL(I,N) returns a matrix L, of the same size as I, containing</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%   labels for the connected components in I. Two adjacent components</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%   (pixels), of respective indexes IDX1 and IDX2, are connected if I(IDX1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%   and I(IDX2) are equal.</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%   N can have a value of either 4 or 8, where 4 specifies 4-connected</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%   objects and 8 specifies 8-connected objects; if the argument is</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%   omitted, it defaults to 8.</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%   Important remark:</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%   ----------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%   NaN values are ignored and considered as background. Because LABEL</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">%   works with arrays of any class, the 0s are NOT considered as the</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">%   background. </span></span></span>
<span class="srcline"><span class="lineno"><a href="196,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">%   Note:</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">%   ----</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">%   The elements of L are integer values greater than or equal to 0. The</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%   pixels labeled 0 are the background (corresponding to the NaN</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">%   components of the input array). The pixels labeled 1 make up one</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">%   object, the pixels labeled 2 make up a second object, and so on.</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%   [L,NUM] = LABEL(<span class="keyword">...</span><span class="comment">) returns in NUM the number of connected objects</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="196,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">%   found in I.</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">%   [L,NUM,SZ] = LABEL(<span class="keyword">...</span><span class="comment">) returns a matrix SZ, of the same size as I,</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="196,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%   that contains the sizes of the connected objects. For a pixel whose</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">%   index is IDX, we have: SZ(IDX) = NNZ(L==L(IDX)).</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">%   Class Support</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">%   -------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">%   I can be logical or numeric. L is double.</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">%   Example</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">%   -------</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">%       I = [3 3 3 0 0 0 0 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">%            3 3 1 0 6.1 6.1 9 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">%            1 3 1 3 6.1 6.1 0 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%            1 3 1 3 0 0 1 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">%            1 3 3 3 3 3 1 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%            1 3 1 0 0 3 1 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">%            1 3 1 0 0 1 1 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%            1 1 1 1 1 0 0 0];</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%       L4 = label(I,4);</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">%       L8 = label(I,8);</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,73" id="srcline73"> 73</a></span><span class="line"><span class="comment">%       subplot(211), imagesc(L4), axis image off</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">%       title('Pixels of same color belong to the same region (4-connection)')</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">%       subplot(212), imagesc(L8), axis image off    </span></span></span>
<span class="srcline"><span class="lineno"><a href="196,76" id="srcline76"> 76</a></span><span class="line"><span class="comment">%       title('Pixels of same color belong to the same region (8-connection)')</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,77" id="srcline77"> 77</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,78" id="srcline78"> 78</a></span><span class="line"><span class="comment">%   Note</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,79" id="srcline79"> 79</a></span><span class="line"><span class="comment">%   ----</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,80" id="srcline80"> 80</a></span><span class="line"><span class="comment">%       % Comparison between BWLABEL and LABEL:</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,81" id="srcline81"> 81</a></span><span class="line"><span class="comment">%       BW = logical([1 1 1 0 0 0 0 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">%                     1 1 1 0 1 1 0 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">%                     1 1 1 0 1 1 0 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">%                     1 1 1 0 0 0 1 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">%                     1 1 1 0 0 0 1 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">%                     1 1 1 0 0 0 1 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">%                     1 1 1 0 0 1 1 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,88" id="srcline88"> 88</a></span><span class="line"><span class="comment">%                     1 1 1 0 0 0 0 0]);</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,89" id="srcline89"> 89</a></span><span class="line"><span class="comment">%       L = bwlabel(BW,4);</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,90" id="srcline90"> 90</a></span><span class="line"><span class="comment">%       % The same result can be obtained with LABEL:</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">%       BW2 = double(BW);</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,92" id="srcline92"> 92</a></span><span class="line"><span class="comment">%       BW2(~BW) = NaN;</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,93" id="srcline93"> 93</a></span><span class="line"><span class="comment">%       L2 = label(BW2,4);</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,94" id="srcline94"> 94</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,95" id="srcline95"> 95</a></span><span class="line"><span class="comment">%   See also BWLABEL, BWLABELN, LABEL2RGB</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,96" id="srcline96"> 96</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,97" id="srcline97"> 97</a></span><span class="line"><span class="comment">%   -- Damien Garcia -- 2010/02, revised 2011/01</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,98" id="srcline98"> 98</a></span><span class="line"><span class="comment">%   http://www.biomecardio.com</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,99" id="srcline99"> 99</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="196,100" id="srcline100">100</a></span><span class="line"><span class="comment">% Check input arguments</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,101" id="srcline101">101</a></span><span class="line"><span class="comment">%narginchk(1,2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,102" id="srcline102">102</a></span><span class="line"><span class="comment">%if nargin==1,</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,103" id="srcline103">103</a></span><span class="line"><span class="comment">%    n=8;</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,104" id="srcline104">104</a></span><span class="line"><span class="comment">%end</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,105" id="srcline105">105</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,106" id="srcline106">106</a></span><span class="line"><span class="comment">%assert(ismatrix(I),'The input I must be a 2-D array')</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,107" id="srcline107">107</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="196,108" id="srcline108">108</a></span><span class="line"><span class="comment">% -----</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,109" id="srcline109">109</a></span><span class="line"><span class="comment">% The Union-Find algorithm is based on the following document:</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,110" id="srcline110">110</a></span><span class="line"><span class="comment">% http://www.cs.duke.edu/courses/cps100e/fall09/notes/UnionFind.pdf</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,111" id="srcline111">111</a></span><span class="line"><span class="comment">% -----</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,112" id="srcline112">112</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="196,113" id="srcline113">113</a></span><span class="line"><span class="comment">% Initialization of the two arrays (ID &amp; SZ) required during the</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,114" id="srcline114">114</a></span><span class="line"><span class="comment">% Union-Find algorithm.</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,115" id="srcline115">115</a></span><span class="line"><span class="mxinfo " id="T8:U6"><span class="var type1" id="S20T8U99">sizI</span> = <span class="mxinfo " id="T8:U8">size(<span class="var type1" id="S18T354U102">I</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,116" id="srcline116">116</a></span><span class="line"><span class="mxinfo " id="T371:U10"><span class="var type1" id="S22T371U105">id</span> = <span class="mxinfo " id="T371:U12">reshape(<span class="mxinfo " id="T380:U13">1:<span class="mxinfo " id="T4:U14">prod(<span class="var type1" id="S20T8U112">sizI</span>)</span></span>,<span class="var type1" id="S20T8U113">sizI</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,117" id="srcline117">117</a></span><span class="line"><span class="mxinfo " id="T371:U17"><span class="var type1" id="S17T371U116">sz</span> = <span class="mxinfo " id="T371:U19">ones(<span class="var type1" id="S20T8U119">sizI</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,118" id="srcline118">118</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="196,119" id="srcline119">119</a></span><span class="line"><span class="comment">% Indexes of the adjacent pixels</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,120" id="srcline120">120</a></span><span class="line"><span class="comment">%vec = @(x) x(:);</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,121" id="srcline121">121</a></span><span class="line"><span class="keyword">if</span> <span class="var type1" id="S19T4U123">n</span>==4 <span class="comment">% 4-connected neighborhood</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,122" id="srcline122">122</a></span><span class="line">    <span class="var type0" id="S26T0U127">idx1</span> = [vec(<span class="var type0" id="S22T0U133">id</span>(:,1:end-1)); vec(<span class="var type0" id="S22T0U145">id</span>(1:end-1,:))];</span></span>
<span class="srcline"><span class="lineno"><a href="196,123" id="srcline123">123</a></span><span class="line">    <span class="var type0" id="S29T0U155">idx2</span> = [vec(<span class="var type0" id="S22T0U161">id</span>(:,2:end)); vec(<span class="var type0" id="S22T0U171">id</span>(2:end,:))];</span></span>
<span class="srcline"><span class="lineno"><a href="196,124" id="srcline124">124</a></span><span class="line"><span class="keyword">elseif</span> <span class="var type1" id="S19T4U179">n</span>==8 <span class="comment">% 8-connected neighborhood</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,125" id="srcline125">125</a></span><span class="line">    <span class="mxinfo " id="T383:U23"><span class="var type1" id="S26T383U183">idx1</span> = <span class="mxinfo " id="T478:U25">[<span class="mxinfo " id="T385:U26">vec(<span class="mxinfo " id="T479:U27"><span class="var type1" id="S22T371U189">id</span>(:,<span class="mxinfo " id="T2:U29"><span class="mxinfo " id="T4:U30">1</span>:<span class="mxinfo " id="T4:U31"><span class="mxinfo " id="T4:U32">end</span>-<span class="mxinfo " id="T4:U33">1</span></span></span>)</span>)</span>; <span class="mxinfo " id="T385:U34">vec(<span class="mxinfo " id="T377:U35"><span class="var type1" id="S22T371U201">id</span>(<span class="mxinfo " id="T2:U37"><span class="mxinfo " id="T4:U38">1</span>:<span class="mxinfo " id="T4:U39"><span class="mxinfo " id="T4:U40">end</span>-<span class="mxinfo " id="T4:U41">1</span></span></span>,:)</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,126" id="srcline126">126</a></span><span class="line">    <span class="mxinfo " id="T384:U42"><span class="var type1" id="S29T384U211">idx2</span> = <span class="mxinfo " id="T480:U44">[<span class="mxinfo " id="T385:U45">vec(<span class="mxinfo " id="T371:U46"><span class="var type1" id="S22T371U217">id</span>(:,<span class="mxinfo " id="T2:U48"><span class="mxinfo " id="T4:U49">2</span>:<span class="mxinfo " id="T4:U50">end</span></span>)</span>)</span>; <span class="mxinfo " id="T385:U51">vec(<span class="mxinfo " id="T371:U52"><span class="var type1" id="S22T371U227">id</span>(<span class="mxinfo " id="T2:U54"><span class="mxinfo " id="T4:U55">2</span>:<span class="mxinfo " id="T4:U56">end</span></span>,:)</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,127" id="srcline127">127</a></span><span class="line">    <span class="mxinfo " id="T383:U57"><span class="var type1" id="S26T383U235">idx1</span> = <span class="mxinfo " id="T383:U59">[<span class="var type1" id="S26T383U238">idx1</span>; <span class="mxinfo " id="T385:U61">vec(<span class="mxinfo " id="T481:U62"><span class="var type1" id="S22T371U243">id</span>(<span class="mxinfo " id="T2:U64"><span class="mxinfo " id="T4:U65">1</span>:<span class="mxinfo " id="T4:U66"><span class="mxinfo " id="T4:U67">end</span>-<span class="mxinfo " id="T4:U68">1</span></span></span>,<span class="mxinfo " id="T2:U69"><span class="mxinfo " id="T4:U70">1</span>:<span class="mxinfo " id="T4:U71"><span class="mxinfo " id="T4:U72">end</span>-<span class="mxinfo " id="T4:U73">1</span></span></span>)</span>)</span>; <span class="mxinfo " id="T385:U74">vec(<span class="mxinfo " id="T479:U75"><span class="var type1" id="S22T371U260">id</span>(<span class="mxinfo " id="T2:U77"><span class="mxinfo " id="T4:U78">2</span>:<span class="mxinfo " id="T4:U79">end</span></span>,<span class="mxinfo " id="T2:U80"><span class="mxinfo " id="T4:U81">1</span>:<span class="mxinfo " id="T4:U82"><span class="mxinfo " id="T4:U83">end</span>-<span class="mxinfo " id="T4:U84">1</span></span></span>)</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,128" id="srcline128">128</a></span><span class="line">    <span class="mxinfo " id="T384:U85"><span class="var type1" id="S29T384U273">idx2</span> = <span class="mxinfo " id="T384:U87">[<span class="var type1" id="S29T384U276">idx2</span>; <span class="mxinfo " id="T385:U89">vec(<span class="mxinfo " id="T371:U90"><span class="var type1" id="S22T371U281">id</span>(<span class="mxinfo " id="T2:U92"><span class="mxinfo " id="T4:U93">2</span>:<span class="mxinfo " id="T4:U94">end</span></span>,<span class="mxinfo " id="T2:U95"><span class="mxinfo " id="T4:U96">2</span>:<span class="mxinfo " id="T4:U97">end</span></span>)</span>)</span>; <span class="mxinfo " id="T385:U98">vec(<span class="mxinfo " id="T377:U99"><span class="var type1" id="S22T371U294">id</span>(<span class="mxinfo " id="T2:U101"><span class="mxinfo " id="T4:U102">1</span>:<span class="mxinfo " id="T4:U103"><span class="mxinfo " id="T4:U104">end</span>-<span class="mxinfo " id="T4:U105">1</span></span></span>,<span class="mxinfo " id="T2:U106"><span class="mxinfo " id="T4:U107">2</span>:<span class="mxinfo " id="T4:U108">end</span></span>)</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,129" id="srcline129">129</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,130" id="srcline130">130</a></span><span class="line">    error(<span class="string">'The second input argument must be either 4 or 8.'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="196,131" id="srcline131">131</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,132" id="srcline132">132</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="196,133" id="srcline133">133</a></span><span class="line"><span class="comment">% Create the groups and merge them (Union/Find Algorithm)</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,134" id="srcline134">134</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S31T4U312">k</span> = <span class="mxinfo " id="T4:U110">1</span>:<span class="mxinfo " id="T4:U111">length(<span class="var type1" id="S26T383U317">idx1</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,135" id="srcline135">135</a></span><span class="line">    <span class="mxinfo " id="T4:U113"><span class="var type1" id="S33T4U320">root1</span> = <span class="mxinfo " id="T4:U115"><span class="var type1" id="S26T383U322">idx1</span>(<span class="var type1" id="S31T4U323">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,136" id="srcline136">136</a></span><span class="line">    <span class="mxinfo " id="T4:U118"><span class="var type1" id="S34T4U326">root2</span> = <span class="mxinfo " id="T4:U120"><span class="var type1" id="S29T384U328">idx2</span>(<span class="var type1" id="S31T4U329">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,137" id="srcline137">137</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="196,138" id="srcline138">138</a></span><span class="line">    <span class="keyword">while</span> <span class="mxinfo " id="T2:U123"><span class="var type1" id="S33T4U332">root1</span>~=<span class="mxinfo " id="T4:U125"><span class="var type1" id="S22T371U334">id</span>(<span class="var type1" id="S33T4U335">root1</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="196,139" id="srcline139">139</a></span><span class="line">        <span class="mxinfo " id="T4:U128"><span class="mxinfo " id="T4:U129"><span class="var type1" id="S22T371U339">id</span>(<span class="var type1" id="S33T4U340">root1</span>)</span> = <span class="mxinfo " id="T4:U132"><span class="var type1" id="S22T371U342">id</span>(<span class="mxinfo " id="T4:U134"><span class="var type1" id="S22T371U344">id</span>(<span class="var type1" id="S33T4U345">root1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,140" id="srcline140">140</a></span><span class="line">        <span class="mxinfo " id="T4:U137"><span class="var type1" id="S33T4U348">root1</span> = <span class="mxinfo " id="T4:U139"><span class="var type1" id="S22T371U350">id</span>(<span class="var type1" id="S33T4U351">root1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,141" id="srcline141">141</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,142" id="srcline142">142</a></span><span class="line">    <span class="keyword">while</span> <span class="mxinfo " id="T2:U142"><span class="var type1" id="S34T4U354">root2</span>~=<span class="mxinfo " id="T4:U144"><span class="var type1" id="S22T371U356">id</span>(<span class="var type1" id="S34T4U357">root2</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="196,143" id="srcline143">143</a></span><span class="line">        <span class="mxinfo " id="T4:U147"><span class="mxinfo " id="T4:U148"><span class="var type1" id="S22T371U361">id</span>(<span class="var type1" id="S34T4U362">root2</span>)</span> = <span class="mxinfo " id="T4:U151"><span class="var type1" id="S22T371U364">id</span>(<span class="mxinfo " id="T4:U153"><span class="var type1" id="S22T371U366">id</span>(<span class="var type1" id="S34T4U367">root2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,144" id="srcline144">144</a></span><span class="line">        <span class="mxinfo " id="T4:U156"><span class="var type1" id="S34T4U370">root2</span> = <span class="mxinfo " id="T4:U158"><span class="var type1" id="S22T371U372">id</span>(<span class="var type1" id="S34T4U373">root2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,145" id="srcline145">145</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,146" id="srcline146">146</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="196,147" id="srcline147">147</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T2:U161"><span class="var type1" id="S33T4U377">root1</span>==<span class="var type1" id="S34T4U378">root2</span></span>, <span class="keyword">continue</span>, <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,148" id="srcline148">148</a></span><span class="line">    <span class="comment">% (The two pixels belong to the same group)</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,149" id="srcline149">149</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="196,150" id="srcline150">150</a></span><span class="line">    <span class="mxinfo " id="T4:U164"><span class="var type1" id="S35T4U382">N1</span> = <span class="mxinfo " id="T4:U166"><span class="var type1" id="S17T371U384">sz</span>(<span class="var type1" id="S33T4U385">root1</span>)</span></span>; <span class="comment">% size of the group belonging to root1</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,151" id="srcline151">151</a></span><span class="line">    <span class="mxinfo " id="T4:U169"><span class="var type1" id="S36T4U388">N2</span> = <span class="mxinfo " id="T4:U171"><span class="var type1" id="S17T371U390">sz</span>(<span class="var type1" id="S34T4U391">root2</span>)</span></span>; <span class="comment">% size of the group belonging to root2</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,152" id="srcline152">152</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="196,153" id="srcline153">153</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T2:U174"><span class="mxinfo " id="T2:U175"><span class="var type1" id="S18T354U396">I</span>(<span class="var type1" id="S33T4U397">root1</span>)</span>==<span class="mxinfo " id="T2:U178"><span class="var type1" id="S18T354U399">I</span>(<span class="var type1" id="S34T4U400">root2</span>)</span></span> <span class="comment">% then merge the two groups</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,154" id="srcline154">154</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T2:U181"><span class="var type1" id="S35T4U404">N1</span> &lt; <span class="var type1" id="S36T4U405">N2</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="196,155" id="srcline155">155</a></span><span class="line">            <span class="mxinfo " id="T4:U184"><span class="mxinfo " id="T4:U185"><span class="var type1" id="S22T371U409">id</span>(<span class="var type1" id="S33T4U410">root1</span>)</span> = <span class="var type1" id="S34T4U411">root2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,156" id="srcline156">156</a></span><span class="line">            <span class="mxinfo " id="T4:U189"><span class="mxinfo " id="T4:U190"><span class="var type1" id="S17T371U415">sz</span>(<span class="var type1" id="S34T4U416">root2</span>)</span> = <span class="mxinfo " id="T4:U193"><span class="var type1" id="S35T4U418">N1</span>+<span class="var type1" id="S36T4U419">N2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,157" id="srcline157">157</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,158" id="srcline158">158</a></span><span class="line">            <span class="mxinfo " id="T4:U196"><span class="mxinfo " id="T4:U197"><span class="var type1" id="S22T371U424">id</span>(<span class="var type1" id="S34T4U425">root2</span>)</span> = <span class="var type1" id="S33T4U426">root1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,159" id="srcline159">159</a></span><span class="line">            <span class="mxinfo " id="T4:U201"><span class="mxinfo " id="T4:U202"><span class="var type1" id="S17T371U430">sz</span>(<span class="var type1" id="S33T4U431">root1</span>)</span> = <span class="mxinfo " id="T4:U205"><span class="var type1" id="S35T4U433">N1</span>+<span class="var type1" id="S36T4U434">N2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,160" id="srcline160">160</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,161" id="srcline161">161</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,162" id="srcline162">162</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,163" id="srcline163">163</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="196,164" id="srcline164">164</a></span><span class="line"><span class="keyword">while</span> 1</span></span>
<span class="srcline"><span class="lineno"><a href="196,165" id="srcline165">165</a></span><span class="line">    <span class="mxinfo " id="T371:U208"><span class="var type1" id="S37T371U439">id0</span> = <span class="var type1" id="S22T371U440">id</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,166" id="srcline166">166</a></span><span class="line">    <span class="mxinfo " id="T371:U211"><span class="var type1" id="S22T371U443">id</span> = <span class="mxinfo " id="T371:U213"><span class="var type1" id="S22T371U445">id</span>(<span class="var type1" id="S22T371U446">id</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,167" id="srcline167">167</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T2:U216">isequal(<span class="var type1" id="S37T371U451">id0</span>,<span class="var type1" id="S22T371U452">id</span>)</span>, </span></span>
<span class="srcline"><span class="lineno"><a href="196,168" id="srcline168">168</a></span><span class="line">        <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,169" id="srcline169">169</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,170" id="srcline170">170</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,171" id="srcline171">171</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="196,172" id="srcline172">172</a></span><span class="line"><span class="mxinfo " id="T371:U219"><span class="var type1" id="S17T371U456">sz</span> = <span class="mxinfo " id="T371:U221"><span class="var type1" id="S17T371U458">sz</span>(<span class="var type1" id="S22T371U459">id</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,173" id="srcline173">173</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="196,174" id="srcline174">174</a></span><span class="line"><span class="comment">% Label matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,175" id="srcline175">175</a></span><span class="line"><span class="comment">%isNaNI = isnan(I);</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,176" id="srcline176">176</a></span><span class="line"><span class="mxinfo " id="T354:U224"><span class="var type1" id="S39T354U462">isNaNI</span> = (<span class="mxinfo " id="T354:U226"><span class="var type1" id="S18T354U465">I</span> == <span class="mxinfo " id="T4:U228">0</span></span>)</span>; <span class="comment">% We operate on logicals</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,177" id="srcline177">177</a></span><span class="line"><span class="mxinfo " id="T385:U229"><span class="mxinfo " id="T385:U230"><span class="var type1" id="S22T371U470">id</span>(<span class="var type1" id="S39T354U471">isNaNI</span>)</span> = <span class="mxinfo " id="T4:U233">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,178" id="srcline178">178</a></span><span class="line">[<span class="mxinfo " id="T385:U234"><span class="var type1" id="S22T385U477">id</span></span>,<span class="mxinfo " id="T4:U236"><span class="mxinfo " id="T385:U237">~</span></span>,<span class="mxinfo " id="T385:U238"><span class="var type1" id="S19T385U479">n</span></span>] = unique(<span class="mxinfo " id="T385:U240"><span class="var type1" id="S22T371U483">id</span>(:)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="196,179" id="srcline179">179</a></span><span class="line"><span class="mxinfo " id="T380:U242"><span class="var type1" id="S18T380U487">I</span> = <span class="mxinfo " id="T380:U244">1:<span class="mxinfo " id="T4:U245">length(<span class="var type1" id="S22T385U492">id</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,180" id="srcline180">180</a></span><span class="line"><span class="mxinfo " id="T371:U247"><span class="var type1" id="S15T371U495">L</span> = <span class="mxinfo " id="T371:U249">reshape(<span class="mxinfo " id="T380:U250"><span class="var type1" id="S18T380U499">I</span>(<span class="var type1" id="S19T385U500">n</span>)</span>,<span class="var type1" id="S20T8U501">sizI</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,181" id="srcline181">181</a></span><span class="line"><span class="mxinfo " id="T385:U254"><span class="mxinfo " id="T385:U255"><span class="var type1" id="S15T371U505">L</span>(<span class="var type1" id="S39T354U506">isNaNI</span>)</span> = <span class="mxinfo " id="T4:U258">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,182" id="srcline182">182</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="196,183" id="srcline183">183</a></span><span class="line"><span class="keyword">if</span> nargout&gt;1, </span></span>
<span class="srcline"><span class="lineno"><a href="196,184" id="srcline184">184</a></span><span class="line">    <span class="mxinfo " id="T4:U259"><span class="var type1" id="S16T4U516">num</span> = <span class="mxinfo " id="T4:U261">nnz(<span class="mxinfo " id="T378:U262">~<span class="mxinfo " id="T378:U263">isnan(<span class="var type1" id="S22T385U522">id</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="196,185" id="srcline185">185</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,186" id="srcline186">186</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="196,187" id="srcline187">187</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="196,188" id="srcline188">188</a></span><span class="line"></span></span>
</pre>
